<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Search & Balance Tracker</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #2c2c2c;
        color: #333;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-between;
        min-height: 100vh;
      }

      .search-container {
        width: 80%;
        max-width: 600px;
        display: flex;
        justify-content: center;
        margin-top: 20vh;
      }

      .search-box {
        display: flex;
        align-items: center;
        background: #fff;
        border-radius: 30px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        padding: 10px 20px;
        width: 100%;
      }

      .search-box select {
        background: transparent;
        border: none;
        font-size: 16px;
        outline: none;
        color: #333;
      }

      .search-box input {
        border: none;
        outline: none;
        flex: 1;
        padding-left: 10px;
        font-size: 16px;
        color: #333;
      }

      .search-box input::placeholder {
        color: #999;
      }

      .content {
        width: 80%;
        max-width: 800px;
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        margin-bottom: 10vh;
        margin-top: 20vh;
      }

      h1 {
        text-align: center;
        margin-bottom: 20px;
      }

      .container {
        margin: auto;
        padding: 20px;
        border-radius: 10px;
      }

      .item {
        text-align: center;
        margin-bottom: 20px;
      }

      .flex-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .progress-bar-container {
        background: #e0e0e0;
        border-radius: 20px;
        overflow: hidden;
        margin: 10px 0;
      }

      .progress-bar {
        height: 20px;
        background: #76c7c0;
        width: 0;
      }

      footer {
        text-align: center;
        margin-top: 20px;
        color: #777;
      }

      @media (max-width: 600px) {
        .search-container,
        .content {
          width: 90%;
        }
      }
    </style>
  </head>

  <body>
    <div class="search-container">
      <div class="search-box">
        <select id="search-engine">
          <option value="https://www.google.com/search?q=" selected>
            Google
          </option>
          <option value="https://www.bing.com/search?q=">Bing</option>
        </select>
        <input
          type="text"
          id="search-query"
          placeholder="搜索..."
          onkeydown="if(event.key === 'Enter') performSearch()"
        />
        <svg
          aria-hidden="true"
          width="20"
          height="20"
          viewBox="0 0 25 25"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            class="gray70_fill_sb"
            d="M10.4167 0C15.7555 0 20.0833 4.32792 20.0833 9.66667C20.0833 11.9759 19.2736 14.0959 17.9227 15.7584L24.4571 22.2929C24.8476 22.6835 24.8476 23.3165 24.4571 23.7071C24.1021 24.0621 23.5465 24.0944 23.1551 23.8039L23.0429 23.7071L16.5084 17.1727C14.8459 18.5236 12.7259 19.3333 10.4167 19.3333C5.07792 19.3333 0.75 15.0055 0.75 9.66667C0.75 4.32792 5.07792 0 10.4167 0ZM10.4167 2C6.18248 2 2.75 5.43248 2.75 9.66667C2.75 13.9008 6.18248 17.3333 10.4167 17.3333C14.6508 17.3333 18.0833 13.9008 18.0833 9.66667C18.0833 5.43248 14.6508 2 10.4167 2Z"
            fill="#767676"
          ></path>
        </svg>
      </div>
    </div>

    <div class="content">
      <div class="container">
        <div class="flex-container">
          <p id="date">日期：加载中...</p>
          <p>今日余额：<span id="today-balance">加载中...</span>元</p>
        </div>
        <div class="item">
          <p>剩余天数 (<span id="remaining-days">加载中...</span>天)</p>
          <div class="progress-bar-container">
            <div class="progress-bar" id="days-progress"></div>
          </div>
        </div>
        <div class="item">
          <p>剩余金额 (<span id="remaining-amount">加载中...</span>元)</p>
          <div class="progress-bar-container">
            <div class="progress-bar" id="amount-progress"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      function performSearch() {
        const engine = document.getElementById("search-engine").value;
        const query = document.getElementById("search-query").value;
        if (query) {
          const url = engine + encodeURIComponent(query);
          window.location.href = url;
        }
      }

      async function fetchData() {
        try {
          const response = await fetch(
            "https://raw.githubusercontent.com/vwumumu/balancer/master/data.json"
          );
          if (response.ok) {
            const data = await response.json();
            updateUI(data);
          } else {
            console.error("无法获取数据：", response.status);
          }
        } catch (error) {
          console.error("获取数据时出错：", error);
        }
      }

      function updateUI(data) {
        const totalAmount = 13500;
        const now = new Date();
        const year = now.getFullYear();
        const month = now.getMonth() + 1;
        const day = now.getDate();

        // 更新日期
        const currentDate = `${year}-${month.toString().padStart(2, "0")}-${day
          .toString()
          .padStart(2, "0")}`;
        document.getElementById("date").textContent = `日期：${currentDate}`;

        // 显示今日余额
        document.getElementById("today-balance").textContent = data.balance;

        // 计算本月剩余天数
        const totalDays = new Date(year, month, 0).getDate();
        const remainingDays = totalDays - day;
        const daysProgress = (remainingDays / totalDays) * 100;
        document.getElementById(
          "days-progress"
        ).style.width = `${daysProgress}%`;
        document.getElementById(
          "days-progress"
        ).textContent = `${daysProgress.toFixed(2)}%`;
        document.getElementById("remaining-days").textContent = remainingDays;

        // 更新剩余金额进度条
        const balance = data.balance + (remainingDays - 1) * 450;
        const amountProgress = (balance / totalAmount) * 100;
        document.getElementById(
          "amount-progress"
        ).style.width = `${amountProgress}%`;
        document.getElementById(
          "amount-progress"
        ).textContent = `${amountProgress.toFixed(2)}%`;
        document.getElementById("remaining-amount").textContent = balance;
      }

      // 初次调用
      fetchData();

      // 设置间隔时间每5分钟更新一次数据（300000毫秒）
      setInterval(fetchData, 300000);
    </script>
  </body>
</html>
